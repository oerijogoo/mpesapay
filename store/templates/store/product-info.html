{% extends "./base.html" %}

{% load static %}

{% block content %}
<div class="container-fluid">
    <main class="pt-5">
        <div class="row g-3 align-items-center flex-nowrap flex-sm-wrap">

            <!-- Product Image -->
            <div class="col-4 col-sm-6 col-md-5 text-center">
                <img class="img-fluid" alt="{{ product.title }}"
                     src="{{ product.image.url }}"
                     style="width: 100%; max-height: 200px; object-fit: contain;">
            </div>

            <!-- Product Details -->
            <div class="col-8 col-sm-6 col-md-7">
                <h1 class="h6 mb-2">{{ product.title }}</h1>
                <strong>{{ product.brand }}</strong>

                <hr class="my-2">

                <p class="small">{{ product.description }}</p>

                <!-- Product Price and Quantity -->
                <div class="border rounded">
                    <!-- Price -->
                    <div class="border-bottom p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Price</span>
                            <span class="h6 fw-bold">Kshs. {{ product.price }}</span>
                        </div>
                    </div>

                    <!-- Quantity and Add to Cart -->
                    <div class="p-2">
                        <div class="row g-2 align-items-center">
                            <!-- Quantity Dropdown -->
                            <div class="col-6">
                                <label for="select" class="form-label small">Qty</label>
                                <select id="select" class="form-select form-select-sm">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>

                            <!-- Add to Cart Button -->
                            <div class="col-6 text-end">
                                <button type="button" id="add-button" value="{{ product.id }}"
                                        class="btn btn-secondary btn-sm w-100">
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- JavaScript -->
<script>
    $(document).on('click', '#add-button', function(e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: '{% url "cart-add" %}',
            data: {
                product_id: $('#add-button').val(),
                product_quantity: $('#select option:selected').val(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success: function(json) {
                document.getElementById('cart-qty').textContent = json.qty;
            },
            error: function(xhr, errmsh, err) {
                console.error("Error adding product to cart:", errmsh);
            }
        });
    });
</script>
{% endblock %}
